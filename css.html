<style>
  :root {
    /* Pop Color Palette */
    --color-bg: #fffbf0;
    --color-primary: #FF6B6B;
    --color-secondary: #4ECDC4;
    --color-accent: #FFE66D;
    --color-dark: #292f36;
    --font-main: "Zen Maru Gothic", sans-serif;
  }
  
  html, body {
    height: 100%;
    margin: 0;
    padding: 0;
    overflow: hidden;
  }

  body {
    font-family: var(--font-main);
    background-color: var(--color-bg);
    background-image: radial-gradient(#ddd 1px, transparent 1px);
    background-size: 20px 20px;
    color: var(--color-dark);
    touch-action: none;
  }

  /* --- Layout & Responsiveness --- */
  #app {
    /* height: 100%; を削除し、Flexboxで制御 */
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 0 !important;
    overflow: hidden;
    position: relative;
    width: 100%;
  }

  .game-wrapper {
    display: flex;
    flex-direction: column;
    height: 100%;
    width: 100%;
    box-sizing: border-box;
    transition: all 0.3s ease;
  }

  /* タブレット・PC (横幅768px以上) */
  @media (min-width: 768px) {
    .game-wrapper {
      flex-direction: row;
      padding: 10px;
      gap: 15px;
      justify-content: center;
    }
    .game-left-panel {
      flex: 0 0 400px;
      max-width: 50%;
      height: 100%;
      overflow-y: auto;
      padding-right: 5px;
      scrollbar-width: thin; 
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      display: flex;
      flex-direction: column;
    }
    
    .game-left-panel.expanded {
      flex: 0 0 800px;
      max-width: 90%;
    }
    
    .game-right-panel {
      flex: 1;
      height: 100%;
      min-width: 0;
      display: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .game-right-panel.show {
      display: block;
      opacity: 1;
    }
  }

  /* スマホ (縦画面) */
  @media (max-width: 767px) {
    .game-wrapper {
      padding: 10px;
      overflow-y: auto;
    }
    .game-left-panel {
      width: 100%;
      flex-shrink: 0;
      min-height: 100%;
      display: flex;
      flex-direction: column;
    }
    .game-right-panel {
      height: 400px;
      width: 100%;
      display: none;
      margin-top: 10px;
    }
    .game-right-panel.show {
      display: block;
    }
  }

  /* --- UI Components --- */
  .header-pop {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-bottom: 3px solid var(--color-secondary);
    z-index: 100;
  }

  footer {
    background: #fff;
    z-index: 100;
  }

  /* --- Loading Animation --- */
  .loading-container {
    background-color: var(--color-bg);
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 9999;
  }

  .loading-stage {
    position: relative;
    width: 120px;
    height: 120px;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .loading-avatar {
    font-size: 4rem;
    animation: bounceChar 0.6s infinite alternate cubic-bezier(0.5, 0.05, 1, 0.5);
    z-index: 2;
    position: relative;
    top: -10px;
  }

  .loading-shadow {
    position: absolute;
    bottom: 20px;
    width: 50px;
    height: 10px;
    background: rgba(0,0,0,0.1);
    border-radius: 50%;
    animation: shadowPulse 0.6s infinite alternate cubic-bezier(0.5, 0.05, 1, 0.5);
  }

  .orbit {
    position: absolute;
    width: 100%;
    height: 100%;
    animation: rotateOrbit 3s linear infinite;
  }

  .orbit-item {
    position: absolute;
    font-weight: 900;
    font-size: 1.5rem;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #fff;
    border-radius: 50%;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
  .orbit-item:nth-child(1) { top: 0; left: 50%; transform: translate(-50%, -50%); color: var(--color-primary); }
  .orbit-item:nth-child(2) { bottom: 0; left: 50%; transform: translate(-50%, 50%); color: var(--color-accent); }
  .orbit-item:nth-child(3) { top: 50%; left: 0; transform: translate(-50%, -50%); color: var(--color-secondary); }
  .orbit-item:nth-child(4) { top: 50%; right: 0; transform: translate(50%, -50%); color: var(--color-dark); }

  @keyframes bounceChar { from { transform: translateY(0); } to { transform: translateY(-20px); } }
  @keyframes shadowPulse { from { transform: scale(1); opacity: 1; } to { transform: scale(0.6); opacity: 0.5; } }
  @keyframes rotateOrbit { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
  
  .loading-text {
    font-family: 'Arial Black', sans-serif;
    letter-spacing: 2px;
    animation: blinkText 1.5s infinite;
    margin-top: 1rem;
  }
  @keyframes blinkText { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

  /* --- Avatar Selector --- */
  .avatar-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 10px;
    margin-bottom: 15px;
  }
  .avatar-option {
    font-size: 2rem;
    background: #fff;
    border: 2px solid #eee;
    border-radius: 50%;
    cursor: pointer;
    transition: transform 0.1s;
    aspect-ratio: 1 / 1;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .avatar-option:hover { transform: scale(1.1); background: #f8f9fa; }
  .avatar-option.selected {
    background-color: var(--color-accent);
    border-color: var(--color-dark);
    transform: scale(1.1);
    box-shadow: 0 4px 0 rgba(0,0,0,0.1);
  }

  /* --- Buttons & Keys --- */
  .btn-pop {
    border: none;
    border-radius: 20px;
    padding: 12px 24px;
    font-weight: 700;
    transition: all 0.1s;
    position: relative;
    top: 0;
    color: #fff;
    box-shadow: 0 6px 0 rgba(0,0,0,0.2);
  }
  .btn-pop:active {
    top: 6px;
    box-shadow: 0 0 0 rgba(0,0,0,0.2);
  }

  .btn-pop-primary { background-color: var(--color-primary); color: #fff; }
  .btn-pop-info { background-color: var(--color-secondary); color: #fff; }
  .btn-pop-success { background-color: #96E6A1; color: #2c5e34; }
  .btn-pop-warning { background-color: var(--color-accent); color: #665c26; }
  .btn-pop-secondary { background-color: #95a5a6; color: #fff; }

  #keypad-area {
    display: flex;
    flex-direction: column;
    gap: 6px;
    height: 100%;
  }
  .row.symbol-row { flex: 0 0 45px; min-height: 40px; }
  .row.num-row { flex: 1; min-height: 50px; }
  .game-left-panel.expanded .row.num-row { min-height: 80px; }
  .game-left-panel.expanded #q-text { font-size: 5rem; }

  .num-key {
    background-color: #fff;
    color: var(--color-primary);
    border: 2px solid var(--color-primary);
    border-radius: 16px;
    font-size: 1.8rem;
    box-shadow: 0 4px 0 #ffcccc;
    transition: all 0.1s;
    height: 100%;
    width: 100%;
  }
  .num-key:active { transform: translateY(4px); box-shadow: none; background-color: #ffe6e6; }

  .symbol-key {
    background-color: #e3f2fd;
    color: #1565c0;
    border: 2px solid #90caf9;
    border-radius: 12px;
    font-size: 1.2rem;
    font-weight: bold;
    box-shadow: 0 2px 0 #bbdefb;
    transition: all 0.1s;
    height: 100%;
    width: 100%;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .symbol-key:active { transform: translateY(2px); box-shadow: none; background-color: #bbdefb; }

  .card-pop {
    border: 3px solid var(--color-dark);
    border-radius: 20px;
    box-shadow: 6px 6px 0 rgba(0,0,0,0.1);
    background: #fff;
    transition: transform 0.2s;
  }
  
  .input-display {
    background-color: #fff;
    border: 3px solid var(--color-dark);
    border-radius: 15px;
    box-shadow: inset 0 4px 8px rgba(0,0,0,0.05);
  }

  .drawing-area {
    background-color: #fff;
    border: 3px solid var(--color-dark);
    border-radius: 15px;
    overflow: hidden;
    touch-action: none;
    position: relative;
    box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
    height: 100%;
    width: 100%;
  }
  
  .bg-grid {
    background-image: linear-gradient(#cfd8dc 1px, transparent 1px), linear-gradient(90deg, #cfd8dc 1px, transparent 1px);
    background-size: 20px 20px;
  }

  .canvas-tools {
    position: absolute;
    top: 10px;
    right: 10px;
    display: flex;
    gap: 8px;
    z-index: 10;
  }

  .tool-btn {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    border: 2px solid var(--color-dark);
    background: white;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: transform 0.1s;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
  .tool-btn:active { transform: scale(0.9); }

  .anim-bounce-in { animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
  @keyframes bounceIn {
    0% { transform: scale(0.3); opacity: 0; }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); opacity: 1; }
  }

  .anim-pop { animation: popSuccess 0.4s ease-out; }
  @keyframes popSuccess {
    0% { transform: scale(1); }
    50% { transform: scale(1.3); color: var(--color-secondary); }
    100% { transform: scale(1); }
  }

  .anim-shake { animation: shakeError 0.4s ease-in-out; }
  @keyframes shakeError {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-10px) rotate(-5deg); }
    75% { transform: translateX(10px) rotate(5deg); }
  }

  .combo-text {
    font-family: 'Arial Black', sans-serif;
    color: var(--color-accent);
    text-shadow: 2px 2px 0 var(--color-dark);
    transform: rotate(-5deg);
  }

  .manager-list-item { cursor: pointer; transition: background 0.1s; }
  .manager-list-item:hover { background-color: #f8f9fa; }
  .table-input { border: none; background: transparent; width: 100%; }
  .table-input:focus { outline: 2px solid var(--color-secondary); background: #fff; }

  ruby { ruby-position: over; }
  rt { font-size: 0.6em; color: #888; }
</style>
