<style>
  /* ==========================================================================
     1. 全体の設定・色・フォント
     ========================================================================== */
  :root {
    /* --- カラーパレット (ここを変えるとアプリ全体の色が変わります) --- */
    --color-bg: #fffbf0;       /* 背景色（クリーム色） */
    --color-primary: #FF6B6B;  /* メインカラー（赤・ピンク系） */
    --color-secondary: #4ECDC4;/* サブカラー（水色系） */
    --color-accent: #FFE66D;   /* アクセントカラー（黄色系） */
    --color-dark: #292f36;     /* 文字色・濃い色（ダークグレー） */
    
    /* --- フォント設定 --- */
    --font-main: "Zen Maru Gothic", sans-serif; /* 丸ゴシック体 */
  }
  
  /* 画面全体の設定 */
  html, body {
    height: 100%;      /* 高さを画面いっぱいにする */
    margin: 0;         /* 余白をなくす */
    padding: 0;
    overflow: hidden;  /* 画面からはみ出した部分は隠す（スクロールさせない） */
  }

  body {
    font-family: var(--font-main);
    background-color: var(--color-bg);
    /* 背景のドット柄の設定 */
    background-image: radial-gradient(#ddd 1px, transparent 1px);
    background-size: 20px 20px;
    color: var(--color-dark);
    touch-action: none; /* スマホでの誤操作（ズームなど）を防ぐ */
  }

  /* ==========================================================================
     2. レイアウト & レスポンシブ設定 (画面サイズによる変化)
     ========================================================================== */
  
  /* アプリ全体の枠組み */
  #app {
    flex: 1; /* 画面の残りの高さを埋める */
    display: flex;
    flex-direction: column; /* 上から下に並べる */
    padding: 0 !important;
    overflow: hidden;
    position: relative;
    width: 100%;
  }

  /* ゲーム画面のレイアウト枠 */
  .game-wrapper {
    display: flex;
    flex-direction: column;
    height: 100%;
    width: 100%;
    box-sizing: border-box;
    transition: all 0.3s ease; /* レイアウト変更時にふわっと動かす */
  }

  /* --- PC・タブレット向け設定 (横幅 768px 以上) --- */
  @media (min-width: 768px) {
    .game-wrapper {
      flex-direction: row; /* 横並びにする */
      padding: 10px;
      gap: 15px; /* 要素の間隔 */
      justify-content: center; /* 中央寄せ */
    }
    
    /* 左パネル（問題・テンキー） */
    .game-left-panel {
      flex: 0 0 400px; /* 幅を400pxに固定 */
      max-width: 50%;
      height: 100%;
      overflow-y: auto; /* 縦スクロール許可 */
      padding-right: 5px;
      scrollbar-width: thin; 
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      display: flex;
      flex-direction: column;
    }
    
    /* メモ帳を開いていない時は左パネルを広げる */
    .game-left-panel.expanded {
      flex: 0 0 800px;
      max-width: 90%;
    }
    
    /* 右パネル（手書きメモエリア） */
    .game-right-panel {
      flex: 1; /* 残りの幅を使う */
      height: 100%;
      min-width: 0;
      display: none; /* デフォルトでは非表示 */
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    /* メモボタンを押した時に表示するクラス */
    .game-right-panel.show {
      display: block;
      opacity: 1;
    }
  }

  /* --- スマホ向け設定 (横幅 767px 以下) --- */
  @media (max-width: 767px) {
    .game-wrapper {
      padding: 10px;
      overflow-y: auto; /* 全体をスクロール可能に */
    }
    
    .game-left-panel {
      width: 100%;
      flex-shrink: 0;
      min-height: 100%;
      display: flex;
      flex-direction: column;
    }
    
    .game-right-panel {
      height: 400px; /* スマホでは高さを固定 */
      width: 100%;
      display: none;
      margin-top: 10px;
    }
    
    .game-right-panel.show {
      display: block;
    }
  }

  /* ==========================================================================
     3. UIコンポーネント (ヘッダー、フッター、カードなど)
     ========================================================================== */
  
  /* ヘッダー（上のバー） */
  .header-pop {
    background: rgba(255, 255, 255, 0.95); /* 半透明の白 */
    backdrop-filter: blur(10px); /* すりガラス効果 */
    border-bottom: 3px solid var(--color-secondary);
    z-index: 100;
  }

  footer {
    background: #fff;
    z-index: 100;
  }

  /* ポップなカードデザイン（枠線太め・影付き） */
  .card-pop {
    border: 3px solid var(--color-dark);
    border-radius: 20px; /* 角丸 */
    box-shadow: 6px 6px 0 rgba(0,0,0,0.1); /* 右下に影 */
    background: #fff;
    transition: transform 0.2s;
  }
  
  /* 入力欄のデザイン */
  .input-display {
    background-color: #fff;
    border: 3px solid var(--color-dark);
    border-radius: 15px;
    box-shadow: inset 0 4px 8px rgba(0,0,0,0.05); /* 内側の影 */
  }

  /* ==========================================================================
     4. ローディングアニメーション
     ========================================================================== */
  .loading-container {
    background-color: var(--color-bg);
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 9999; /* 最前面に表示 */
  }

  .loading-stage {
    position: relative;
    width: 120px;
    height: 120px;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  /* アバターが跳ねるアニメーション */
  .loading-avatar {
    font-size: 4rem;
    animation: bounceChar 0.6s infinite alternate cubic-bezier(0.5, 0.05, 1, 0.5);
    z-index: 2;
    position: relative;
    top: -10px;
  }

  /* 影のアニメーション */
  .loading-shadow {
    position: absolute;
    bottom: 20px;
    width: 50px;
    height: 10px;
    background: rgba(0,0,0,0.1);
    border-radius: 50%;
    animation: shadowPulse 0.6s infinite alternate cubic-bezier(0.5, 0.05, 1, 0.5);
  }

  /* 記号が回るアニメーション */
  .orbit {
    position: absolute;
    width: 100%;
    height: 100%;
    animation: rotateOrbit 3s linear infinite;
  }

  .orbit-item {
    position: absolute;
    font-weight: 900;
    font-size: 1.5rem;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #fff;
    border-radius: 50%;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
  /* 4つの記号の位置と色 */
  .orbit-item:nth-child(1) { top: 0; left: 50%; transform: translate(-50%, -50%); color: var(--color-primary); }
  .orbit-item:nth-child(2) { bottom: 0; left: 50%; transform: translate(-50%, 50%); color: var(--color-accent); }
  .orbit-item:nth-child(3) { top: 50%; left: 0; transform: translate(-50%, -50%); color: var(--color-secondary); }
  .orbit-item:nth-child(4) { top: 50%; right: 0; transform: translate(50%, -50%); color: var(--color-dark); }

  /* アニメーション定義 */
  @keyframes bounceChar { from { transform: translateY(0); } to { transform: translateY(-20px); } }
  @keyframes shadowPulse { from { transform: scale(1); opacity: 1; } to { transform: scale(0.6); opacity: 0.5; } }
  @keyframes rotateOrbit { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
  
  .loading-text {
    font-family: 'Arial Black', sans-serif;
    letter-spacing: 2px;
    animation: blinkText 1.5s infinite;
    margin-top: 1rem;
  }
  @keyframes blinkText { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

  /* ==========================================================================
     5. アバター選択画面
     ========================================================================== */
  .avatar-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr); /* 5列で表示 */
    gap: 10px;
    margin-bottom: 15px;
  }
  .avatar-option {
    font-size: 2rem;
    background: #fff;
    border: 2px solid #eee;
    border-radius: 50%;
    cursor: pointer;
    transition: transform 0.1s;
    aspect-ratio: 1 / 1; /* 正方形を保つ */
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .avatar-option:hover { transform: scale(1.1); background: #f8f9fa; }
  
  /* 選択されたアバター */
  .avatar-option.selected {
    background-color: var(--color-accent);
    border-color: var(--color-dark);
    transform: scale(1.1);
    box-shadow: 0 4px 0 rgba(0,0,0,0.1);
  }

  /* ==========================================================================
     6. ボタン & テンキー
     ========================================================================== */
  
  /* 共通のポップなボタン */
  .btn-pop {
    border: none;
    border-radius: 20px;
    padding: 12px 24px;
    font-weight: 700;
    transition: all 0.1s;
    position: relative;
    top: 0;
    color: #fff;
    box-shadow: 0 6px 0 rgba(0,0,0,0.2); /* 立体的な影 */
  }
  /* 押した時の動き */
  .btn-pop:active {
    top: 6px; /* 沈み込む */
    box-shadow: 0 0 0 rgba(0,0,0,0.2); /* 影をなくす */
  }

  /* ボタンの色バリエーション */
  .btn-pop-primary { background-color: var(--color-primary); color: #fff; }
  .btn-pop-info { background-color: var(--color-secondary); color: #fff; }
  .btn-pop-success { background-color: #96E6A1; color: #2c5e34; }
  .btn-pop-warning { background-color: var(--color-accent); color: #665c26; }
  .btn-pop-secondary { background-color: #95a5a6; color: #fff; }

  /* テンキーエリアのレイアウト */
  #keypad-area {
    display: flex;
    flex-direction: column;
    gap: 6px;
    height: 100%;
  }
  .row.symbol-row { flex: 0 0 45px; min-height: 40px; } /* 記号キーの行 */
  .row.num-row { flex: 1; min-height: 50px; } /* 数字キーの行 */
  
  /* 画面が広いときは数字キーを大きく */
  .game-left-panel.expanded .row.num-row { min-height: 80px; }
  .game-left-panel.expanded #q-text { font-size: 5rem; }

  /* 数字キーのデザイン */
  .num-key {
    background-color: #fff;
    color: var(--color-primary);
    border: 2px solid var(--color-primary);
    border-radius: 16px;
    font-size: 1.8rem;
    box-shadow: 0 4px 0 #ffcccc;
    transition: all 0.1s;
    height: 100%;
    width: 100%;
  }
  .num-key:active { transform: translateY(4px); box-shadow: none; background-color: #ffe6e6; }

  /* 記号キーのデザイン */
  .symbol-key {
    background-color: #e3f2fd;
    color: #1565c0;
    border: 2px solid #90caf9;
    border-radius: 12px;
    font-size: 1.2rem;
    font-weight: bold;
    box-shadow: 0 2px 0 #bbdefb;
    transition: all 0.1s;
    height: 100%;
    width: 100%;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .symbol-key:active { transform: translateY(2px); box-shadow: none; background-color: #bbdefb; }

  /* ==========================================================================
     7. 手書きメモエリア & アニメーション
     ========================================================================== */
  
  /* 手書きエリアの外枠 */
  .drawing-area {
    background-color: #fff;
    border: 3px solid var(--color-dark);
    border-radius: 15px;
    overflow: hidden;
    touch-action: none;
    position: relative;
    box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
    height: 100%;
    width: 100%;
  }
  
  /* 方眼紙のような背景 */
  .bg-grid {
    background-image: linear-gradient(#cfd8dc 1px, transparent 1px), linear-gradient(90deg, #cfd8dc 1px, transparent 1px);
    background-size: 20px 20px;
  }

  /* メモエリア内のツールボタン（削除ボタンなど） */
  .canvas-tools {
    position: absolute;
    top: 10px;
    right: 10px;
    display: flex;
    gap: 8px;
    z-index: 10;
  }

  .tool-btn {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    border: 2px solid var(--color-dark);
    background: white;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: transform 0.1s;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
  .tool-btn:active { transform: scale(0.9); }

  /* --- アニメーション効果 --- */
  
  /* 画面切り替え時の「ぽよん」と出るアニメーション */
  .anim-bounce-in { animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
  @keyframes bounceIn {
    0% { transform: scale(0.3); opacity: 0; }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); opacity: 1; }
  }

  /* 正解した時のポップアニメーション */
  .anim-pop { animation: popSuccess 0.4s ease-out; }
  @keyframes popSuccess {
    0% { transform: scale(1); }
    50% { transform: scale(1.3); color: var(--color-secondary); }
    100% { transform: scale(1); }
  }

  /* 不正解の時の揺れるアニメーション */
  .anim-shake { animation: shakeError 0.4s ease-in-out; }
  @keyframes shakeError {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-10px) rotate(-5deg); }
    75% { transform: translateX(10px) rotate(5deg); }
  }

  /* コンボ表示のテキストスタイル */
  .combo-text {
    font-family: 'Arial Black', sans-serif;
    color: var(--color-accent);
    text-shadow: 2px 2px 0 var(--color-dark);
    transform: rotate(-5deg);
  }

  /* --- 管理画面用 --- */
  .manager-list-item { cursor: pointer; transition: background 0.1s; }
  .manager-list-item:hover { background-color: #f8f9fa; }
  .table-input { border: none; background: transparent; width: 100%; }
  .table-input:focus { outline: 2px solid var(--color-secondary); background: #fff; }

  /* ルビ（ふりがな）の位置調整 */
  ruby { ruby-position: over; }
  rt { font-size: 0.6em; color: #888; }

  /* ==========================================================================
     8. 数式の表示 (分数など)
     ========================================================================== */
  
  /* 分数を縦に並べるスタイル */
  .fraction {
    display: inline-flex;       /* インライン要素の中でフレックスボックスを使う */
    flex-direction: column;     /* 上下に並べる */
    vertical-align: middle;     /* 周りの文字と高さを合わせる */
    text-align: center;         /* 数字を中央揃え */
    font-size: 0.75em;          /* 分数は少し小さめにしないと行が広がりすぎる */
    margin: 0 0.2em;            /* 左右に少し隙間 */
  }

  /* 分子（上の数字） */
  .numerator {
    border-bottom: 3px solid currentColor; /* 下線（括線）を引く */
    padding: 0 0.2em;           /* 横の余白 */
    line-height: 1.1;           /* 行間を詰める */
  }

  /* 分母（下の数字） */
  .denominator {
    padding: 0 0.2em;
    line-height: 1.1;
  }
</style>
